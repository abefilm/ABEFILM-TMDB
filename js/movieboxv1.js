(()=>{document.addEventListener("DOMContentLoaded",()=>{function Y(P){let W={};async function _(){try{let[R,s]=await Promise.all([fetch(`https://api.themoviedb.org/3/genre/movie/list?api_key=${P}&language=en-US`).then(m=>m.json()),fetch(`https://api.themoviedb.org/3/genre/tv/list?api_key=${P}&language=en-US`).then(m=>m.json())]);[...R.genres||[],...s.genres||[]].forEach(m=>W[m.id]=m.name)}catch(R){console.error("Failed to load genres:",R)}}let D=document.querySelector(".search-input"),C=document.getElementById("search-results");if(D&&C){let s=function(c){C.innerHTML="";let y=c.filter($=>["movie","tv"].includes($.media_type)&&$.poster_path).slice(0,6);if(y.length===0){C.style.display="none";return}y.forEach(async $=>{let H=$.title||$.name||"Untitled",j=`https://image.tmdb.org/t/p/w92${$.poster_path}`,O=($.release_date||$.first_air_date||"").split("-")[0]||"N/A",F=$.media_type==="movie"?"Movie":"TV Show",w=document.createElement("li");w.innerHTML=`
                        <img src="${j}" alt="${H}">
                        <div class="search-info">
                            <p>${H}</p>
                            <small>${F} | ${O}</small>
                        </div>`,w.addEventListener("click",()=>{window.location.href=`/p/details.html?id=${$.id}&type=${$.media_type}`}),C.appendChild(w)}),C.style.display="block"};var U=s;async function R(c){let y=`https://api.themoviedb.org/3/search/multi?api_key=${P}&query=${encodeURIComponent(c)}&language=en-US`;try{return(await(await fetch(y)).json()).results||[]}catch{return[]}}let m;D.addEventListener("input",()=>{let c=D.value.trim();clearTimeout(m),m=setTimeout(async()=>{if(c.length>=2){let y=await R(c);s(y)}else C.style.display="none"},300)}),document.addEventListener("click",c=>{c.target.closest(".search-container")||(C.style.display="none")})}let V=document.getElementById("library");if(V){let T=function(){let x=new Date().getFullYear();for(let S=x;S>=1950;S--)O.innerHTML+=`<option value="${S}">${S}</option>`;F.innerHTML+=Object.entries(W).map(([S,i])=>`<option value="${S}">${i}</option>`).join(""),[H,j,O,F,w,I].forEach(S=>{S.addEventListener("change",()=>{R=1,B(!0)})})},B=function(x=!1){if(m)return;m=!0,x&&($.innerHTML="");let S=H.value,i=O.value,l=F.value,f=w.value,p=y.value.trim(),g=I.value,r=p.length>=2,L=r?`https://api.themoviedb.org/3/search/${S}?api_key=${P}&language=en-US&query=${encodeURIComponent(p)}&page=${R}`:`https://api.themoviedb.org/3/discover/${S}?api_key=${P}&language=en-US&sort_by=popularity.desc&page=${R}`;g&&(L+=`&vote_average.gte=${g}`),r||(i&&(L+=`&primary_release_year=${i}`),l&&(L+=`&with_genres=${l}`),f&&(L+=`&with_origin_country=${f}`)),fetch(L).then(h=>h.json()).then(h=>{if(!h.results||h.results.length===0){R===1&&($.innerHTML="<p>No results found.</p>"),m=!1;return}s=h.total_pages;let q=h.results.map((v,o)=>{let n=v.title||v.name||"Untitled",a=(v.release_date||v.first_air_date||"").split("-")[0]||"N/A",d=v.vote_average?v.vote_average.toFixed(1):"N/A",b=(v.genre_ids||[]).map(e=>W[e]).filter(Boolean).join(", ")||"N/A",M=v.overview?v.overview.slice(0,160)+"\u2026":"No overview available.",E=(R-1)*20+o+1;return`
                        <div class="movie-card" data-id="${v.id}" data-type="${S}">
                            <div class="movie-thumbnail">
                              <img src="${v.poster_path?`https://image.tmdb.org/t/p/w300${v.poster_path}`:"https://i.imgur.com/YyHsyEr.png"}" alt="${n}">
                              <div class="movie-rank rank-${E<=10?E:"default"}">${E}</div>
                            </div>
                            <div class="movie-info">
                              <div>
                                <div class="movie-title">${n}</div>
                                <div class="movie-meta">${S.charAt(0).toUpperCase()+S.slice(1)} \u2022 ${d} \u2022 ${a}</div>
                                <div class="movie-genres"><span>${b}</span></div>
                                <div class="movie-overview">${M}</div>
                              </div>
                              <div class="movie-actions">
                               <button class="play-button" onclick="window.location.href='/p/details.html?id=${v.id}&type=${S}'">
                                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path d="M18.89 12.85c-.35 1.34-2.02 2.29-5.36 4.19-3.23 1.84-4.84 2.76-6.14 2.42a4.3 4.3 0 0 1-1.42-.84C5 17.61 5 15.74 5 12s0-5.61.97-6.58c.4-.4.9-.69 1.43-.83 1.3-.37 2.91.55 6.14 2.4 3.34 1.9 5.01 2.85 5.36 4.19.15.55.15 1.14 0 1.67Z" stroke="currentColor" stroke-width="1.5" stroke-linejoin="round"/></svg>
                                  Play
                                </button>
                              </div>
                            </div>
                          </div>`}).join("");$.insertAdjacentHTML("beforeend",q),m=!1}).catch(h=>{$.innerHTML="<p>Error loading content.</p>",console.error(h),m=!1})},Z=function(){m||R>=s||window.scrollY+window.innerHeight>=document.body.offsetHeight-400&&(R++,B())};var z=T,ee=B,Q=Z;let R=1,s=1,m=!1,c,y=document.getElementById("search-bar"),$=document.getElementById("library-content"),H=document.getElementById("type-filter"),j=document.getElementById("status-filter"),O=document.getElementById("year-filter"),F=document.getElementById("genre-filter"),w=document.getElementById("country-filter"),I=document.getElementById("rating-filter");T(),B(!0),window.addEventListener("scroll",Z),y.addEventListener("input",()=>{clearTimeout(c),c=setTimeout(()=>{R=1,B(!0)},400)})}_().then(()=>{V&&initializeLibrary(P)})}function K(){let P=0,W=50,_=setInterval(()=>{window.apiKey?(clearInterval(_),Y(window.apiKey)):P++>=W&&(clearInterval(_),console.error("API Key (window.apiKey) was not found. Search/Library will not function."))},100)}K()});document.addEventListener("DOMContentLoaded",()=>{document.addEventListener("click",function(s){if(s.target.classList.contains("scroll-btn")||s.target.classList.contains("cast-scroll-btn")||s.target.classList.contains("tmdb-scroll")){let c=s.target.closest(".cast-scroll-wrapper, .tmdb-wrapper")?.querySelector(".cast-scroll, .tmdb-row");if(c){let y=s.target.classList.contains("left")?-1:1,$=c.clientWidth;c.scrollBy({left:y*$,behavior:"smooth"})}}});let Y;function K(){if(document.getElementById("custom-toast-notification"))return;let s=document.createElement("div");s.id="custom-toast-notification",document.body.appendChild(s)}function P(s,m="info"){let c=document.getElementById("custom-toast-notification");c&&(clearTimeout(Y),c.textContent=s,c.className="toast-show "+m,Y=setTimeout(()=>{c.className=c.className.replace("toast-show","")},3e3))}function W(){let s=document.getElementById("bookmark-count");if(s){let m=JSON.parse(localStorage.getItem("abefilm_bookmarks")||"[]");s.textContent=m.length,s.style.display=m.length>0?"flex":"none"}}function _(){let s=document.getElementById("bookmark-list");if(!s)return;let m=JSON.parse(localStorage.getItem("abefilm_bookmarks")||"[]");s.innerHTML=m.length===0?"<li>Your watchlist is empty.</li>":m.map((c,y)=>`
      <li class="bookmark-item">
        <a href="${c.url}" class="bookmark-link">
          <img src="${c.poster||"https://i.imgur.com/YyHsyEr.png"}" alt="${c.title}" class="bookmark-thumb">
          <span class="bookmark-title">${c.title}</span>
        </a>
        <button class="delete-bookmark" data-index="${y}" title="Remove">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M7.84254 5.48939L8.52333 5.80406L7.84254 5.48939ZM8.81802 4.18112L8.31749 3.62258L8.31749 3.62258L8.81802 4.18112ZM10.2779 3.30696L10.5389 4.01009L10.2779 3.30696ZM13.7221 3.30696L13.9831 2.60384V2.60384L13.7221 3.30696ZM16.1575 5.48939L16.8383 5.17471L16.1575 5.48939ZM8.25 7.03259C8.25 6.61367 8.34194 6.19649 8.52333 5.80406L7.16175 5.17471C6.89085 5.76079 6.75 6.39238 6.75 7.03259H8.25ZM8.52333 5.80406C8.70487 5.41133 8.97357 5.04881 9.31855 4.73966L8.31749 3.62258C7.82675 4.06235 7.43251 4.58893 7.16175 5.17471L8.52333 5.80406ZM9.31855 4.73966C9.66369 4.43037 10.0778 4.18126 10.5389 4.01009L10.0169 2.60384C9.38616 2.83798 8.80808 3.18295 8.31749 3.62258L9.31855 4.73966ZM10.5389 4.01009C11.0001 3.8389 11.4968 3.75 12 3.75V2.25C11.3213 2.25 10.6477 2.36972 10.0169 2.60384L10.5389 4.01009ZM12 3.75C12.5032 3.75 12.9999 3.8389 13.4611 4.01009L13.9831 2.60384C13.3523 2.36972 12.6787 2.25 12 2.25V3.75ZM13.4611 4.01009C13.9222 4.18126 14.3363 4.43037 14.6815 4.73966L15.6825 3.62258C15.1919 3.18295 14.6138 2.83798 13.9831 2.60384L13.4611 4.01009ZM14.6815 4.73966C15.0264 5.04881 15.2951 5.41133 15.4767 5.80406L16.8383 5.17471C16.5675 4.58893 16.1733 4.06235 15.6825 3.62258L14.6815 4.73966ZM15.4767 5.80406C15.6581 6.19649 15.75 6.61367 15.75 7.03259H17.25C17.25 6.39238 17.1092 5.7608 16.8383 5.17471L15.4767 5.80406Z" fill="var(--keycolor)"></path><path d="M3 6.28259C2.58579 6.28259 2.25 6.61838 2.25 7.03259C2.25 7.44681 2.58579 7.78259 3 7.78259V6.28259ZM21 7.78259C21.4142 7.78259 21.75 7.44681 21.75 7.03259C21.75 6.61838 21.4142 6.28259 21 6.28259V7.78259ZM5 7.03259V6.28259H4.25V7.03259H5ZM19 7.03259H19.75V6.28259H19V7.03259ZM18.3418 16.8303L19.0624 17.0383L18.3418 16.8303ZM13.724 20.8553L13.8489 21.5949L13.724 20.8553ZM10.276 20.8553L10.401 20.1158L10.401 20.1158L10.276 20.8553ZM10.1183 20.8287L9.9933 21.5682L9.9933 21.5682L10.1183 20.8287ZM5.65815 16.8303L4.93757 17.0383L5.65815 16.8303ZM13.8817 20.8287L13.7568 20.0892L13.8817 20.8287ZM3 7.78259H21V6.28259H3V7.78259ZM13.7568 20.0892L13.599 20.1158L13.8489 21.5949L14.0067 21.5682L13.7568 20.0892ZM10.401 20.1158L10.2432 20.0892L9.9933 21.5682L10.151 21.5949L10.401 20.1158ZM18.25 7.03259V12.1758H19.75V7.03259H18.25ZM5.75 12.1759V7.03259H4.25V12.1759H5.75ZM18.25 12.1758C18.25 13.6806 18.0383 15.1776 17.6212 16.6223L19.0624 17.0383C19.5185 15.4583 19.75 13.8212 19.75 12.1758H18.25ZM13.599 20.1158C12.5404 20.2947 11.4596 20.2947 10.401 20.1158L10.151 21.5949C11.3751 21.8017 12.6248 21.8017 13.8489 21.5949L13.599 20.1158ZM10.2432 20.0892C8.40523 19.7786 6.90157 18.4335 6.37873 16.6223L4.93757 17.0383C5.61878 19.3981 7.58166 21.1607 9.9933 21.5682L10.2432 20.0892ZM6.37873 16.6223C5.9617 15.1776 5.75 13.6806 5.75 12.1759H4.25C4.25 13.8212 4.48148 15.4583 4.93757 17.0383L6.37873 16.6223ZM14.0067 21.5682C16.4183 21.1607 18.3812 19.3981 19.0624 17.0383L17.6212 16.6223C17.0984 18.4335 15.5947 19.7786 13.7568 20.0892L14.0067 21.5682ZM5 7.78259H19V6.28259H5V7.78259Z" fill="#6c6e76"></path><path d="M10 12V16M14 12V16" stroke="var(--keycolor)" stroke-width="1.5" stroke-linecap="round"></path></g></svg>
        </button>
      </li>`).join("")}let D=document.querySelector(".bookmark-btn"),C=document.getElementById("bookmark-modal");D&&C&&(D.addEventListener("click",s=>{s.preventDefault();let m=C.style.display==="block";C.style.display=m?"none":"block",m||_()}),document.addEventListener("click",s=>{C.style.display==="block"&&!C.contains(s.target)&&!D.contains(s.target)&&(C.style.display="none")}),C.addEventListener("click",s=>{let m=s.target.closest(".delete-bookmark");if(m){s.stopPropagation();let c=parseInt(m.getAttribute("data-index")),y=JSON.parse(localStorage.getItem("abefilm_bookmarks")||"[]");y.splice(c,1),localStorage.setItem("abefilm_bookmarks",JSON.stringify(y)),_(),W()}}));function V(s){let m=s.querySelector(".cast-scroll, .tmdb-row"),c=s.querySelector(".scroll-btn.left, .cast-scroll-btn.left, .tmdb-scroll.left"),y=s.querySelector(".scroll-btn.right, .cast-scroll-btn.right, .tmdb-scroll.right");if(!m||!c||!y)return;new ResizeObserver(()=>{if(!(m.scrollWidth>m.clientWidth+5)){c.style.display="none",y.style.display="none";return}let j=()=>{let O=Math.ceil(m.scrollLeft),F=m.scrollWidth-m.clientWidth;c.style.display=O>1?"flex":"none",y.style.display=O<F-1?"flex":"none"};m.addEventListener("scroll",j,{passive:!0}),j()}).observe(m)}function U(s){function m(w,I){let T="https://api.themoviedb.org/3/",B=new URL(T+w);return B.searchParams.set("api_key",I),B.searchParams.set("language","en-US"),B.toString()}function c(w,I){return w.media_type&&(w.media_type==="movie"||w.media_type==="tv")?w.media_type:I.startsWith("tv/")||I.startsWith("discover/tv")||I.startsWith("trending/tv")?"tv":"movie"}async function y(w,I){let T=document.getElementById("tmdb-slider"),B=document.getElementById("slider-dots"),Z=document.getElementById("slider-title");if(!T||!B||!Z)return;T.innerHTML="",B.innerHTML="";async function x(i,l={}){let{timeout:f=8e3}=l,p=new AbortController,g=setTimeout(()=>p.abort(),f);try{let r=await fetch(i,{...l,signal:p.signal});return clearTimeout(g),r}catch(r){throw clearTimeout(g),r}}try{let n=function(a){v=a,h.forEach((d,b)=>d.style.display=b===a?"block":"none"),q.forEach((d,b)=>d.classList.toggle("active",b===a)),Z.textContent=L[a]||"",o&&clearInterval(o),o=setInterval(()=>changeSlide(1),5e3)};var S=n;let i=m(w,I),l=await x(i);if(!l.ok)throw new Error(`Failed to fetch slider data: ${l.status}`);let p=((await l.json()).results||[]).slice(0,8);if(p.length===0){T.innerHTML="<p>No slider content found.</p>";return}let g=p.map(async a=>{let d=c(a,w);try{let b=m(`${d}/${a.id}/images`,I)+"&include_image_language=en,null",M=await x(b);if(!M.ok)throw new Error(`Logo fetch failed: ${M.status}`);let E=await M.json();if(E.logos&&E.logos.length){let e=E.logos.filter(t=>t.iso_639_1==="en");return e.length===0&&(e=E.logos),e.sort((t,u)=>(u.vote_average||0)-(t.vote_average||0)),e[0].file_path||null}return null}catch{return null}}),r=await Promise.all(g),L=[];for(let a=0;a<p.length;a++){let d=p[a],b=c(d,w),M=d.title||d.name||"Untitled",E=d.backdrop_path;if(!E)continue;let e=r[a],t=`${window.location.origin}/p/details.html?id=${d.id}&type=${b}`,u=document.createElement("a");u.className="slide",u.href=t,u.style.backgroundImage=`url(https://image.tmdb.org/t/p/original${E})`;let k=e?`<img class="logo-title" src="https://image.tmdb.org/t/p/w500${e}" alt="${M} Logo" />`:`<h2>${M}</h2>`;u.innerHTML=`<div class="slide-caption">${k}</div>`,T.appendChild(u),L.push(M);let A=document.createElement("div");A.className="thumbnail-dot",A.setAttribute("data-index",a),A.style.backgroundImage=`url(https://image.tmdb.org/t/p/w300${E})`,A.onclick=()=>n(a),B.appendChild(A)}let h=T.querySelectorAll(".slide"),q=B.querySelectorAll(".thumbnail-dot"),v=0,o;window.changeSlide=a=>{v=(v+a+h.length)%h.length,n(v)},h.length>0&&n(0)}catch(i){console.error("Failed to load slider content:",i),T&&(T.innerHTML="<p style='color:red;'>Error loading slider.</p>")}}function $(w,I){document.querySelectorAll(".widget-content").forEach(T=>{let B=T.closest(".widget");if(!B||["HTML01","Text1","Text2"].includes(B.id))return;let Z=T.textContent.trim();if(!Z||Z.includes(" ")||Z.startsWith("http"))return;let x=document.createElement("div");x.className="tmdb-wrapper";let S=document.createElement("div");S.className="tmdb-row",S.innerHTML=[...Array(7)].map(()=>`<div class="tmdb-card shimmer-card"><div class="tmdb-thumb shimmer"><img src="${I}" class="tmdb-logo" alt="Logo" /></div><div class="tmdb-title shimmer"></div></div>`).join(""),x.appendChild(S),T.insertAdjacentElement("afterend",x),new IntersectionObserver(async(l,f)=>{for(let p of l)if(p.isIntersecting){f.unobserve(p.target);try{let g=new Promise(a=>setTimeout(a,500)),r=m(Z,w),L=fetch(r).then(a=>a.json()),[h,q]=await Promise.all([g,L]),v=q.results||[];if(v.length===0){S.innerHTML="<p>No results found.</p>";return}S.innerHTML=v.slice(0,14).map(a=>{let d=c(a,Z),b=a.title||a.name||"Untitled",M=a.poster_path;if(!M)return"";let E=(a.release_date||a.first_air_date||"").split("-")[0]||"N/A",e=a.vote_average?.toFixed(1)||"N/A",t=`${window.location.origin}/p/details.html?id=${a.id}&type=${d}`;return`<a class="tmdb-card" title="${b}" href="${t}"><div class="tmdb-thumb"><img src="https://image.tmdb.org/t/p/w300${M}" alt="${b}" loading="lazy" /><div class="hover-overlay"></div><span class="tmdb-meta tmdb-year">${E}</span><span class="tmdb-meta tmdb-rating"><i class="bi bi-star"></i> ${e}</span><div class="play-btn"><svg viewBox="0 0 24 24" width="48" height="48" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22Z" fill="var(--keycolor)"/><path d="M15.4137 13.059L10.6935 15.8458C9.93371 16.2944 9 15.7105 9 14.7868V9.21316C9 8.28947 9.93371 7.70561 10.6935 8.15419L15.4137 10.941C16.1954 11.4026 16.1954 12.5974 15.4137 13.059Z" fill="#FFFFFF"/></svg></div></div><div class="tmdb-title">${b}</div></a>`}).join("");let o=document.createElement("button");o.className="tmdb-scroll left",o.innerHTML="&#8249;";let n=document.createElement("button");n.className="tmdb-scroll right",n.innerHTML="&#8250;",x.prepend(o),x.append(n),V(x)}catch(g){S.innerHTML="<p style='color:red;'>Failed to load data.</p>",console.error(g)}}},{threshold:.1,rootMargin:"150px 0px"}).observe(x)})}let H=document.querySelector("#Text1 .widget-content"),O=document.querySelector("#Text2 .widget-content")?.textContent.trim()||"",F=H?.textContent.trim();F&&y(F,apiKey),$(apiKey,O)}function z(s){let c=document.querySelector("#Text1 .widget-content")?.textContent.trim()||"https://api.themoviedb.org/3",y="https://image.tmdb.org/t/p/w500",$=new URLSearchParams(window.location.search),H=$.get("id"),j=$.get("type")||"movie",O=document.getElementById("movie-details-container"),F=1;async function w(){if(!H||!j){O.innerHTML="<p>Missing ID or type.</p>";return}try{let[i,l,f]=await Promise.all([fetch(`${c}/${j}/${H}?api_key=${s}&language=en-US`),fetch(`${c}/${j}/${H}/credits?api_key=${s}&language=en-US`),fetch(`${c}/${j}/${H}/${j==="movie"?"release_dates":"content_ratings"}?api_key=${s}`)]),p=await i.json(),g=await l.json(),r=await f.json(),L=I(j,r);T(p,g,L),j==="tv"?B(p.seasons):x(H),await S();let h=document.getElementById("cast-list");if(h&&g.cast?.length>0){let v=g.cast.slice(0,15).map(n=>`<div class="cast-card"><img src="${n.profile_path?y+n.profile_path:"https://i.imgur.com/obaaZjk.png"}" alt="${n.name}"><div>${n.name}</div><small>${n.character}</small></div>`).join(""),o=document.createElement("div");o.className="cast-scroll-wrapper",o.innerHTML=`<button class="scroll-btn left" aria-label="Scroll Left">\u2039</button><div class="cast-scroll">${v}</div><button class="scroll-btn right" aria-label="Scroll Right">\u203A</button>`,h.replaceWith(o),V(o)}let q=document.getElementById("user-reviews");try{let o=await(await fetch(`${c}/${j}/${H}/reviews?api_key=${s}&language=en-US`)).json();q&&(o.results&&o.results.length>0?q.innerHTML=o.results.slice(0,5).map(n=>{let a=n.author||"Anonymous",d=n.author_details?.avatar_path,b=d?d.startsWith("/https")?d.slice(1):`https://image.tmdb.org/t/p/w45${d}`:"https://ui-avatars.com/api/?name="+encodeURIComponent(a),M=new Date(n.created_at).toLocaleDateString();return`<div class="user-review"><div class="review-header"><img class="review-avatar" src="${b}" alt="${a}'s profile"><div><strong>${a}</strong><br><small>${M}</small></div></div><p class="review-content">${n.content.length>300?n.content.substring(0,300)+"...":n.content}</p></div>`}).join(""):q.innerHTML="<p>No user reviews available.</p>")}catch{q&&(q.innerHTML="<p>Failed to load user reviews.</p>")}}catch{O.innerHTML="<p>Error fetching details.</p>"}}function I(i,l){return i==="movie"?l.results?.find(p=>p.iso_3166_1==="US")?.release_dates?.[0]?.certification||"NR":l.results?.find(p=>p.iso_3166_1==="US")?.rating||"NR"}function T(i,l,f){let p=i.title||i.name,g=(i.release_date||i.first_air_date||"").split("-")[0]||"Unknown",r=i.genres?.map(d=>d.name).join("<span>|</span>")||"Unknown",L=i.vote_average?.toFixed(1)||"N/A",h=i.vote_count?.toLocaleString()||"0",q=i.overview||"No synopsis available.",v=i.poster_path?`${y}${i.poster_path}`:"https://i.imgur.com/YyHsyEr.png",o=i.backdrop_path?`https://image.tmdb.org/t/p/original${i.backdrop_path}`:"",n=i.origin_country?.[0]||i.production_countries?.[0]?.name||"Unknown",a=j==="tv"?"TV":"Movie";O.innerHTML=`<div class="detail-wrap"><div class="info-rating-wrapper"><div class="poster" style="--backdrop-url: url('${o}')"><img id="details-poster-img" data-main-poster="${v}" src="${v}" alt="${p}" /><div class="poster-play-btn" data-id="${H}" data-type="${j}" ${j==="tv"?'data-season="1"':""}><svg viewBox="0 0 24 24" width="48" height="48" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22Z" fill="transparent"></path><path d="M15.4137 13.059L10.6935 15.8458C9.93371 16.2944 9 15.7105 9 14.7868V9.21316C9 8.28947 9.93371 7.70561 10.6935 8.15419L15.4137 10.941C16.1954 11.4026 16.1954 12.5974 15.4137 13.059Z" fill="#FFFFFF"></path></svg></div></div><div id="trailer-modal"><div id="modal-trailer-container"></div><div class="close-btn">&times;</div></div><div class="info"><h1 data-original-title="${p}">${p}</h1><div class="meta">${a} <span>|</span> ${g} <span>|</span> ${f} <span>|</span> ${n} <span>|</span> ${r}</div><p class="tagline">${q}</p><div class="buttons"><button class="watch" onclick="goToPlayer()"><i class="bi bi-play-fill"></i> Watch Now</button><button class="bookmark" onclick="bookmarkItem()"><i class="bi bi-bookmark"></i> Add to Watchlist</button><button class="share"><i class="bi bi-box-arrow-up-right"></i> Share</button></div></div><div class="rating"><i class="bi bi-star-fill"></i><strong>${L}</strong><span>/10</span><div class="vote-count">(${h} people rated)</div></div></div></div><div class="episode-placeholder" id="section-episodes"><h3>Episodes</h3><div class="episode-wrapper"><div id="season-buttons" class="season-wrap"></div><div id="episode-buttons" class="episode-wrap"></div></div></div><div class="details-extra-section"><div class="left-column"><div class="top-cast" id="section-cast"><h3>Top Cast</h3><div id="cast-list" class="cast-scroll"></div></div><div class="user-reviews"><h3>User Reviews</h3><div id="user-reviews" id="section-reviews"></div></div></div><div class="right-column"><h3>More Like This</h3><div id="more-like-grid" class="more-like-grid"></div></div></div>`}async function B(i){let l=document.getElementById("season-buttons");if(!l)return;l.innerHTML="",(i||[]).filter(g=>g.season_number!==0).forEach(g=>{let r=document.createElement("button");r.className="ep-btn season-btn",r.dataset.seasonNumber=g.season_number,r.dataset.airDate=g.air_date||"",r.dataset.posterPath=g.poster_path||"",r.textContent=`S${g.season_number}`,r.onclick=()=>{document.querySelectorAll(".season-btn").forEach(L=>L.classList.remove("active")),r.classList.add("active"),Z(r.dataset.seasonNumber,r.dataset.airDate,r.dataset.posterPath)},l.appendChild(r)});let p=l.querySelector(".season-btn");p&&p.click()}async function Z(i,l,f){F=i;let p=document.getElementById("episode-buttons"),g=document.querySelector(".info h1"),r=document.querySelector(".info .meta"),L=document.getElementById("details-poster-img"),h=document.querySelector(".poster-play-btn");if(h&&(h.dataset.season=i),g){let d=g.dataset.originalTitle||g.innerText.split(" S")[0];g.textContent=`${d} S${i}`}if(r&&l){let d=l.split("-")[0]||"N/A",b=r.innerHTML.split("<span>|</span>");b.length>1&&(b[1]=` ${d} `,r.innerHTML=b.join("<span>|</span>"))}L&&(f&&f!=="null"?L.src=`${y}${f}`:L.src=L.dataset.mainPoster);let v=await(await fetch(`${c}/tv/${H}/season/${i}?api_key=${s}&language=en-US`)).json(),n=window.innerWidth<=600?14:35,a=(d,b=!1)=>{if(!p)return;if(p.innerHTML="",((b||(d||[]).length<=n?d:(d||[]).slice(0,n))||[]).forEach(E=>{let e=document.createElement("a");e.className="btn episode-btn",e.textContent=String(E.episode_number).padStart(2,"0"),e.href=`/p/player.html?id=${H}&type=tv&season=${i}&ep=${E.episode_number}`,p.appendChild(e)}),(d||[]).length>n){let E=document.createElement("button");E.className=`btn episode-btn ${b?"hide-btn":"show-more"}`,E.textContent=b?"Hide":"More",E.onclick=()=>a(v.episodes,!b),p.appendChild(E)}};v.episodes&&a(v.episodes,!1)}async function x(i){let l=document.getElementById("season-buttons"),f=document.getElementById("episode-buttons");l.innerHTML="",f.innerHTML="";let g=await(await fetch(`${c}/movie/${i}?api_key=${s}&language=en-US`)).json();if(g.belongs_to_collection)((await(await fetch(`https://api.themoviedb.org/3/collection/${g.belongs_to_collection.id}?api_key=${s}`)).json()).parts||[]).sort((v,o)=>new Date(v.release_date)-new Date(o.release_date)).forEach((v,o)=>{let n=document.createElement("a");n.className="ep-btn season-btn"+(v.id==i?" active":""),n.textContent=`Part ${o+1}`,n.href=`${window.location.origin}/p/details.html?id=${v.id}&type=movie`,l.appendChild(n)});else{let L=document.createElement("button");L.className="ep-btn season-btn active",L.textContent="S1",l.appendChild(L)}let r=document.createElement("a");r.className="btn episode-btn",r.textContent="01",r.href=`/p/player.html?id=${i}&type=movie`,f.appendChild(r)}async function S(){let i=document.getElementById("more-like-grid");i.innerHTML="";try{let f=await(await fetch(`${c}/${j}/${H}/recommendations?api_key=${s}&language=en-US`)).json();if(!f.results||f.results.length===0){i.innerHTML="<p>No recommendations available.</p>";return}f.results.slice(0,6).forEach(p=>{let g=document.createElement("a");g.href=`${window.location.origin}/p/details.html?id=${p.id}&type=${j}`,g.className="more-like-item abefilm-hover-card";let r=p.poster_path?`${y}${p.poster_path}`:"https://i.imgur.com/YyHsyEr.png";g.innerHTML=`<div class="abefilm-image-wrap"><img src="${r}" alt="${p.title||p.name}" onerror="this.src='https://i.imgur.com/YyHsyEr.png';"><div class="abefilm-hover-overlay"></div><div class="abefilm-play-button"><svg viewBox="0 0 24 24" width="48" height="48" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22Z" fill="var(--keycolor)"></path><path d="M15.4137 13.059L10.6935 15.8458C9.93371 16.2944 9 15.7105 9 14.7868V9.21316C9 8.28947 9.93371 7.70561 10.6935 8.15419L15.4137 10.941C16.1954 11.4026 16.1954 12.5974 15.4137 13.059Z" fill="#FFFFFF"></path></svg></div></div><p>${p.title||p.name}</p>`,i.appendChild(g)})}catch{i.innerHTML="<p>Failed to load recommendations.</p>"}}window.goToPlayer=function(){let i=new URLSearchParams(window.location.search),l=i.get("id"),f=i.get("type");if(l&&f){let p=f==="tv"?`/p/player.html?id=${l}&type=tv&season=${F}&ep=1`:`/p/player.html?id=${l}&type=movie`;window.location.href=p}},window.bookmarkItem=function(){let i=new URLSearchParams(window.location.search),l=i.get("id"),f=i.get("type")||"movie",p=document.querySelector(".info h1")?.innerText,g=document.querySelector(".poster img")?.src;if(!l||!f||!p){P("Cannot add to watchlist: missing info.","info");return}let r=JSON.parse(localStorage.getItem("abefilm_bookmarks")||"[]");if(r.some(h=>h.id===l&&h.type===f)){P("Already on your watchlist","info");return}let L=`/p/details.html?id=${l}&type=${f}`;r.push({id:l,type:f,title:p,poster:g,url:L}),localStorage.setItem("abefilm_bookmarks",JSON.stringify(r)),P("Added to Watchlist","success"),W()},document.addEventListener("click",async function(i){if(i.target.closest(".poster-play-btn")){let l=i.target.closest(".poster-play-btn"),f=l.getAttribute("data-id"),p=l.getAttribute("data-type"),g=l.getAttribute("data-season"),r=document.getElementById("modal-trailer-container"),L=document.getElementById("trailer-modal");try{let h;p==="tv"&&g?h=`${c}/tv/${f}/season/${g}/videos?api_key=${s}&language=en-US`:h=`${c}/${p}/${f}/videos?api_key=${s}&language=en-US`;let v=await(await fetch(h)).json(),o=v.results.find(n=>n.type==="Trailer"&&n.site==="YouTube")||v.results.find(n=>n.type==="Teaser"&&n.site==="YouTube");o?r.innerHTML=`<iframe src="https://www.youtube.com/embed/${o.key}?autoplay=1" allowfullscreen allow="autoplay; encrypted-media" frameborder="0"></iframe>`:r.innerHTML="<p>No trailer found for this season.</p>",L.classList.add("active")}catch{r.innerHTML="<p>Error loading trailer.</p>",L.classList.add("active")}}if(i.target.closest(".share")){let l=window.location.href,f=document.querySelector(".info h1")?.innerText||"Check this out!";navigator.share?navigator.share({title:f,text:"Watch this online:",url:l}):navigator.clipboard.writeText(l).then(()=>P("Link copied!","success"),()=>prompt("Copy link:",l))}if(i.target.classList.contains("close-btn")){let l=document.getElementById("trailer-modal");l&&l.classList.remove("active");let f=document.getElementById("modal-trailer-container");f&&(f.innerHTML="")}}),w()}function ee(s){let m=new URLSearchParams(window.location.search),c=m.get("id"),y=m.get("type");if(!c||!y){document.body.innerHTML="<p style='color:white; text-align:center;'>Missing ID or type in URL.</p>";return}let $=`watch_state_${c}_${y}`;function H(o,n,a){let d={server:o,season:n,episode:a};localStorage.setItem($,JSON.stringify(d))}function j(){let o=localStorage.getItem($);return o?JSON.parse(o):null}function O(o,n,a){fetch(`https://api.themoviedb.org/3/${n}/${o}?api_key=${s}&language=en-US`).then(d=>d.json()).then(d=>{let b=d.title||d.name||"Untitled",M=n==="tv"?` S${a}`:"";document.title=`${b}${M} - Watch Now | AbeFilm`}).catch(d=>console.error("Title update failed:",d))}let F=document.getElementById("video-left"),w=document.getElementById("player-episode-buttons"),I=document.getElementById("server-buttons"),T=document.createElement("div");T.id="season-buttons",T.classList.add("season-button-container"),I&&I.insertAdjacentElement("afterend",T);let B=j(),Z=B?.season,x=parseInt(m.get("season")||Z||"1"),S=parseInt(m.get("ep")||B?.episode||"1"),i=B?.episode||S,l=B?.server||null,f={};function p(){let o=document.getElementById("video-sources");if(!o)return;o.querySelectorAll(".widget").forEach(a=>{let d=a.querySelector(".widget-title, .title")?.textContent.trim().toLowerCase(),b=a.querySelector(".widget-content")?.textContent.trim();if(d&&b){let M=b.split(`
`).map(t=>t.trim()).filter(Boolean),E=null,e=null;for(let t of M)/\${episode}/.test(t)?e=t:/\${id}/.test(t)&&(E=t);f[d]={movie:t=>E?E.replace(/\$\{id\}/g,t):"",tv:(t,u,k)=>e?e.replace(/\$\{id\}/g,t).replace(/\$\{season\}/g,u).replace(/\$\{episode\}/g,k):""}}})}function g(o=1){i=o;let n=f[l];if(!n||!F)return;let a=y==="movie"?n.movie(c):n.tv(c,x,o);F.innerHTML=a?`<iframe src="${a}" frameborder="0" allowfullscreen loading="lazy" style="width:100%;height:100%;max-height:100vh;"></iframe>`:"<p style='color:white'>Invalid or missing source URL.</p>"}function r(){I&&Object.keys(f).forEach(o=>{let n=document.createElement("button");n.textContent=o.toUpperCase(),n.className="server-btn",l||(l=o),o===l&&n.classList.add("active"),n.addEventListener("click",()=>{document.querySelectorAll(".server-btn").forEach(a=>a.classList.remove("active")),n.classList.add("active"),l=o,H(l,x,i),g(i)}),I.appendChild(n)})}function L(o){if(!w)return;w.innerHTML="";for(let d=1;d<=o;d++){let b=document.createElement("button");b.textContent=`${d}`,b.className="player-episode-btn",b.addEventListener("click",()=>{document.querySelectorAll(".player-episode-btn").forEach(M=>M.classList.remove("active")),b.classList.add("active"),H(l,x,d),g(d)}),w.appendChild(b)}let n=w.querySelectorAll(".player-episode-btn"),a=n[S-1]||n[0];a&&a.classList.add("active"),g(S)}function h(){if(!w)return;w.innerHTML="";let o=document.createElement("button");o.textContent="1",o.className="player-episode-btn active",w.appendChild(o)}function q(o){let n=document.getElementById("footer-bottom");if(!n)return;let{title:a,name:d,overview:b,genres:M,status:E,vote_average:e,first_air_date:t,release_date:u,number_of_episodes:k}=o,A=k?"TV":"Movie",G=(u||t||"").split("-")[0];if(y==="tv"&&o?.seasons&&x){let J=o.seasons.find(X=>X.season_number==x);J?.air_date&&(G=J.air_date.split("-")[0])}let N=e?e.toFixed(1):"N/A",ie=M?.map(J=>J.name).join(", ")||"Unknown",re=E||"Unknown",ne=o.certification||o.content_ratings?.results?.find(J=>J.iso_3166_1==="US")?.rating||"NR";n.innerHTML=`<div class="footer-left"><div class="footer-title-rating"><strong>${a||d||"Untitled"}${k?` S${x}`:""} (${G})</strong></div><div class="footer-meta"><span class="footer-rating">\u2B50 ${N}</span><span class="type-meta">${A}</span> \u2022 <span>${re}</span> \u2022 <span>Rated: ${ne}</span></div><div class="footer-genres"><strong>Genres:</strong> ${ie}</div><div class="footer-overview">${b||"No overview available."}</div><span class="read-more-toggle">More</span></div><div class="footer-right"><h3>Recommended</h3><div class="recommendation-grid"></div></div>`;let se=n.querySelector(".footer-overview"),oe=n.querySelector(".read-more-toggle");se&&oe&&window.innerWidth<=768&&oe.addEventListener("click",()=>{se.classList.toggle("expanded"),oe.textContent=se.classList.contains("expanded")?"Less":"More"}),fetch(`https://api.themoviedb.org/3/${k?"tv":"movie"}/${o.id}/credits?api_key=${s}`).then(J=>J.json()).then(J=>{let X=J.cast?.slice(0,15);if(X?.length>0){let te=document.createElement("div");te.className="footer-cast-scroll-wrapper",te.innerHTML=`<h4>Cast</h4><div class="cast-scroll-wrapper"><button class="cast-scroll-btn left" aria-label="Scroll Left">\u2039</button><div class="cast-scroll">${X.map(ae=>`<div class="cast-card"><img src="${ae.profile_path?`https://image.tmdb.org/t/p/w185${ae.profile_path}`:"https://i.imgur.com/obaaZjk.png"}" alt="${ae.name}" onerror="this.onerror=null;this.src='https://i.imgur.com/obaaZjk.png';"><div class="cast-name">${ae.name}</div><div class="cast-role">${ae.character}</div></div>`).join("")}</div><button class="cast-scroll-btn right" aria-label="Scroll Right">\u203A</button></div>`,n.querySelector(".footer-left").appendChild(te),V(te.querySelector(".cast-scroll-wrapper"))}}).catch(J=>console.error("Cast Fetch Error:",J))}function v(o,n){let a=document.querySelector(".recommendation-grid");if(!a)return;let d=`https://api.themoviedb.org/3/${n}/${o}/recommendations?api_key=${s}`;fetch(d).then(b=>b.json()).then(b=>{let M=b.results?.slice(0,6);if(!M||M.length===0){a.innerHTML="<p style='color:#ccc'>No recommendations available.</p>";return}a.innerHTML=M.map(E=>{let e=E.title||E.name||"Untitled",t=E.poster_path?`https://image.tmdb.org/t/p/w185${E.poster_path}`:"https://i.imgur.com/YyHsyEr.png",u=E.media_type||(E.first_air_date?"tv":"movie");return`<div class="rec-item"><a href="/p/player.html?id=${E.id}&type=${u}"><div class="rec-thumb"><img src="${t}" alt="${e}" onerror="this.onerror=null;this.src='https://i.imgur.com/YyHsyEr.png';"><div class="abefilm-hover-overlay"></div><div class="abefilm-play-button"><svg viewBox="0 0 24 24" width="48" height="48" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22Z" fill="var(--keycolor)"/><path d="M15.4137 13.059L10.6935 15.8458C9.93371 16.2944 9 15.7105 9 14.7868V9.21316C9 8.28947 9.93371 7.70561 10.6935 8.15419L15.4137 10.941C16.1954 11.4026 16.1954 12.5974 15.4137 13.059Z" fill="#FFFFFF"/></svg></div></div><span>${e}</span></a></div>`}).join("")}).catch(b=>{console.error("Recommendation Fetch Error:",b),a.innerHTML="<p style='color:#ccc'>Failed to load recommendations.</p>"})}O(c,y,x),p(),Object.keys(f).length>0?(r(),g(i)):F&&(F.innerHTML="<p style='color:white'>No server templates found.</p>"),y==="tv"?(fetch(`https://api.themoviedb.org/3/tv/${c}?api_key=${s}`).then(o=>o.json()).then(o=>{q(o),v(o.id,y),o.seasons&&o.seasons.length>0&&T&&(T.innerHTML=o.seasons.filter(n=>n.season_number!==0).map(n=>`<a href="?id=${c}&type=tv&season=${n.season_number}" class="season-btn${n.season_number===x?" active":""}">${n.name}</a>`).join(""))}),fetch(`https://api.themoviedb.org/3/tv/${c}/season/${x}?api_key=${s}`).then(o=>o.json()).then(o=>{L(o.episodes?.length||0)})):y==="movie"&&(fetch(`https://api.themoviedb.org/3/movie/${c}?api_key=${s}`).then(o=>o.json()).then(o=>{q(o),v(o.id,y),o.belongs_to_collection?.id&&fetch(`https://api.themoviedb.org/3/collection/${o.belongs_to_collection.id}?api_key=${s}`).then(n=>n.json()).then(n=>{n.parts&&n.parts.length>1&&T&&(T.innerHTML=n.parts.sort((a,d)=>new Date(a.release_date)-new Date(d.release_date)).map((a,d)=>`<a href="?id=${a.id}&type=movie&part=${d+1}" class="season-btn${a.id==c?" active":""}">${"Part "+(d+1)}</a>`).join(""))})}),h(),g())}function Q(s){K(),W();let m=window.location.pathname,c=m.includes("/p/details.html"),y=m.includes("/p/player.html");c?z(s):y?ee(s):document.getElementById("tmdb-slider")&&U(s)}function R(){let s=0,m=50,c=setInterval(()=>{window.apiKey?(clearInterval(c),Q(window.apiKey)):s++>=m&&(clearInterval(c),console.error("FATAL: API Key (window.apiKey) was not found. App will not run."),[document.getElementById("tmdb-slider"),document.getElementById("movie-details-container"),document.getElementById("video-left")].forEach($=>{$&&($.innerHTML="<p style='color:red; text-align:center; padding: 2rem;'>Error: API configuration is missing.</p>")}))},100)}R()});document.addEventListener("DOMContentLoaded",function(){let Y=window.location.href,K=window.innerWidth<=768,P=location.origin+"/",W=location.pathname==="/"||location.pathname.endsWith("/index.html")||location.hostname.includes("blogspot.com")&&!location.pathname.includes("/p/"),_=Y.includes("/p/details.html"),D=Y.includes("/p/player.html"),C=Y.includes("/p/library.html"),V=Y.includes("/p/about-us.html"),U=Y.includes("/p/privacy-policy.html"),z=Y.includes("/p/disclaimer.html"),ee=document.querySelector("#Text12 .widget-content"),Q=document.querySelector("#Text13 .widget-content"),R=document.querySelector("#Text14 .widget-content"),s=document.querySelector("footer .website-name"),m=document.querySelector("footer .website-description"),c=document.querySelector("footer .credit");if(ee&&s&&(s.innerHTML=ee.innerHTML),Q&&m&&(m.innerHTML=Q.innerHTML),R&&c){c.innerHTML=R.innerHTML;let r=c.querySelector("#currentYear");r&&(r.textContent=new Date().getFullYear())}let y=document.getElementById("about-us"),$=document.getElementById("privacy-policy"),H=document.getElementById("disclaimer"),j=document.querySelector("#Text10 .widget-content"),O=document.querySelector("#Text9 .widget-content"),F=document.querySelector("#Text11 .widget-content");V&&y&&j&&(y.innerHTML=j.innerHTML),U&&$&&O&&($.innerHTML=O.innerHTML),z&&H&&F&&(H.innerHTML=F.innerHTML);let w=document.getElementById("details-content"),I=document.getElementById("player-content"),T=document.getElementById("library");w&&(w.style.display=_?"block":"none"),I&&(I.style.display=D?"block":"none"),T&&(T.style.display=C?"block":"none"),y&&(y.style.display=V?"block":"none"),$&&($.style.display=U?"block":"none"),H&&(H.style.display=z?"block":"none"),D&&(document.querySelector(".top-header")?.remove(),document.querySelector(".side-menu")?.remove()),C&&K&&document.querySelector(".top-header")?.remove();let B={home:"tmdb-section-1",movies:"tmdb-section-2",tvseries:"tmdb-section-3",animation:"tmdb-section-4",kdramas:"tmdb-section-5",cdramas:"tmdb-section-6",anime:"tmdb-section-7","western-movies":"tmdb-section-8","western-series":"tmdb-section-9"};if(document.querySelectorAll('.side-menu a[href^="#"], .bottom-navbar a[href^="#"], .anchor-links a[href^="#"]').forEach(r=>{r.addEventListener("click",function(L){W||(L.preventDefault(),window.location.href=P+this.getAttribute("href"))})}),!W&&location.hash&&B[location.hash.replace("#","")]){window.location.href=P+location.hash;return}if(W){let r=()=>{let L=window.location.hash.replace("#","")||"home";Object.entries(B).forEach(([h,q])=>{let v=document.getElementById(q);v&&(v.style.display=h===L?"block":"none")}),document.querySelectorAll(".side-menu a, .bottom-navbar a, .anchor-links a").forEach(h=>{let q=h.getAttribute("href")?.replace("#","");h.classList.toggle("active",q===L)})};r(),window.addEventListener("hashchange",r)}let Z;function x(r,L="info"){let h=document.getElementById("custom-toast-notification");h||(h=document.createElement("div"),h.id="custom-toast-notification",document.body.appendChild(h)),clearTimeout(Z),h.textContent=r,h.className="toast-show "+L,Z=setTimeout(()=>{h.className=h.className.replace("toast-show","")},3e3)}let S=document.querySelector(".top-header");if(S){let r=()=>{W&&!K?S.classList.toggle("scrolled",window.scrollY>100):K||S.classList.add("scrolled")};window.addEventListener("scroll",r),r()}let i=document.getElementById("toggleSidebar"),l=document.getElementById("mobileSidebar"),f=document.getElementById("sidebarOverlay");i&&l&&f&&(i.addEventListener("click",()=>{l.classList.toggle("active"),f.style.display=l.classList.contains("active")?"block":"none"}),f.addEventListener("click",()=>{l.classList.remove("active"),f.style.display="none"})),document.querySelector(".share-btn")?.addEventListener("click",()=>{navigator.share?navigator.share({title:document.title,url:window.location.href}).catch(r=>console.warn("Share failed:",r)):navigator.clipboard.writeText(window.location.href).then(()=>x("Link copied to clipboard!","success")).catch(()=>x("Could not copy link.","error"))}),document.querySelector(".top-btn")?.addEventListener("click",()=>{window.scrollTo({top:0,behavior:"smooth"})}),document.querySelector(".back-history")?.addEventListener("click",r=>{r.preventDefault(),window.history.length>1?window.history.back():window.location.href="/"});let p=document.getElementById("comment-nav-button"),g=document.getElementById("comment-section");p&&g&&p.addEventListener("click",r=>{r.preventDefault(),g.scrollIntoView({behavior:"smooth",block:"start"})})});document.addEventListener("DOMContentLoaded",()=>{if(!document.getElementById("comment-section"))return;let{createClient:K}=supabase,_=K("https://hwucnfgzeghfmagromyb.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imh3dWNuZmd6ZWdoZm1hZ3JvbXliIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ2MzUwMjMsImV4cCI6MjA3MDIxMTAyM30.Sl8JjfFj9iEWZxwun9XzaZeQcEN1BtfcU2FmlGdemI8"),D=new URLSearchParams(window.location.search),C=D.get("id"),V=D.get("type"),U=C&&V?`${V}-${C}`:window.location.pathname,z=document.getElementById("authModal"),ee=document.getElementById("closeAuthModalBtn"),Q=document.getElementById("showAuthModalBtn"),R=document.getElementById("loginPrompt"),s=document.getElementById("commentFormContainer"),m=document.getElementById("message"),c=document.getElementById("submit"),y=document.getElementById("logoutBtn"),$=document.getElementById("avatarModal"),H=document.getElementById("closeAvatarModalBtn"),j=document.getElementById("currentUserAvatar"),O=document.getElementById("currentUsernameDisplay"),F=document.getElementById("saveAvatarBtn"),w=null,I="https://cdn-icons-png.flaticon.com/128/1046/1046929.png",T=!0,B=!1,Z={},x={person:["https://cdn-icons-png.flaticon.com/128/4139/4139981.png","https://cdn-icons-png.flaticon.com/128/4140/4140057.png","https://cdn-icons-png.flaticon.com/128/4140/4140077.png","https://cdn-icons-png.flaticon.com/128/2202/2202112.png","https://cdn-icons-png.flaticon.com/128/4140/4140061.png","https://cdn-icons-png.flaticon.com/128/4140/4140037.png","https://cdn-icons-png.flaticon.com/128/4140/4140051.png","https://cdn-icons-png.flaticon.com/128/4139/4139951.png","https://cdn-icons-png.flaticon.com/128/4140/4140060.png","https://cdn-icons-png.flaticon.com/128/6997/6997662.png","https://cdn-icons-png.flaticon.com/128/4140/4140040.png","https://cdn-icons-png.flaticon.com/128/4140/4140047.png"],animal:["https://cdn-icons-png.flaticon.com/128/4322/4322991.png","https://cdn-icons-png.flaticon.com/128/4775/4775614.png","https://cdn-icons-png.flaticon.com/128/4775/4775640.png","https://cdn-icons-png.flaticon.com/128/1326/1326390.png","https://cdn-icons-png.flaticon.com/128/9308/9308861.png","https://cdn-icons-png.flaticon.com/128/9308/9308872.png","https://cdn-icons-png.flaticon.com/128/1326/1326415.png","https://cdn-icons-png.flaticon.com/128/9308/9308930.png","https://cdn-icons-png.flaticon.com/128/1760/1760998.png","https://cdn-icons-png.flaticon.com/128/1326/1326401.png","https://cdn-icons-png.flaticon.com/128/4775/4775517.png","https://cdn-icons-png.flaticon.com/128/9308/9308916.png","https://cdn-icons-png.flaticon.com/128/3940/3940435.png","https://cdn-icons-png.flaticon.com/128/6740/6740990.png","https://cdn-icons-png.flaticon.com/128/4775/4775608.png","https://cdn-icons-png.flaticon.com/128/1005/1005364.png","https://cdn-icons-png.flaticon.com/128/6740/6740990.png","https://cdn-icons-png.flaticon.com/128/4775/4775608.png"],animation:["https://i.pinimg.com/1200x/f5/44/96/f544962a7b3129c0637ac2ae3822ce04.jpg","https://i.pinimg.com/1200x/17/86/c4/1786c496eb64a64f81181de49638d713.jpg","https://i.pinimg.com/736x/6d/d0/73/6dd073b2fa2e8e85b3667f76a233300c.jpg","https://i.pinimg.com/736x/0b/41/df/0b41dff69b51c42493489ed10eada7ee.jpg","https://i.pinimg.com/1200x/57/c4/ac/57c4acf284c8278a97dd862b90d0a7f6.jpg","https://i.pinimg.com/736x/8b/38/fe/8b38fe784ebdef337b2e5925e849b865.jpg","https://i.pinimg.com/736x/f7/2c/d1/f72cd11d081fda86f6defac97834fa6a.jpg","https://i.pinimg.com/736x/22/dc/88/22dc88835f11c148a26724be02ba37d6.jpg","https://i.pinimg.com/736x/08/97/a3/0897a36b7d6da0a57ee8a1fed7f67bbc.jpg","https://i.pinimg.com/736x/4f/50/5b/4f505b0e22c2fb9de8df11606d63aee3.jpg","https://i.pinimg.com/1200x/cf/40/37/cf40375b3ad057d3b6759fd7b5cfc69b.jpg","https://i.pinimg.com/736x/21/da/6a/21da6af1a11272715f67c3d5ccac4941.jpg","https://i.pinimg.com/736x/71/d8/00/71d8003e7580495d0bafd80eccd3b3c0.jpg","https://i.pinimg.com/736x/be/38/78/be3878c34f93d1663a6e5f6af4b78e9c.jpg","https://i.pinimg.com/736x/33/3d/d0/333dd06be42713804de17ae38caa0680.jpg","https://i.pinimg.com/1200x/dc/89/44/dc8944d0b4f1174080edb5bb66e97eaf.jpg","https://i.pinimg.com/736x/a7/6e/32/a76e3272f50feb992792ee874910d233.jpg","https://i.pinimg.com/1200x/77/70/3f/77703fafc70fcf5e37089acd53fd514a.jpg"],emoji:["https://i.pinimg.com/736x/5b/8b/26/5b8b26358e27e259ca5b308adb0007d9.jpg","https://i.pinimg.com/1200x/4e/ed/e3/4eede304ca4f6bfcc857e9343c33fc95.jpg","https://i.pinimg.com/1200x/15/e8/32/15e832be938d0e6ed7266bf789d71bb7.jpg","https://i.pinimg.com/1200x/87/a6/a3/87a6a35d663a034c38bdf8b7be022acd.jpg","https://i.pinimg.com/1200x/43/27/bd/4327bd2cf07e8311bcf05fce38aedc9a.jpg","https://i.pinimg.com/1200x/08/16/61/081661bd0bf7ec4b45d4fc3dd820a60f.jpg","https://i.pinimg.com/1200x/23/c0/06/23c00684fe980429026b8d012e64f25c.jpg","https://i.pinimg.com/1200x/2a/34/06/2a3406c7a142f9173536f3f7d744edc5.jpg","https://i.pinimg.com/736x/9e/f1/84/9ef1846a74700af02e30898ff0e4b730.jpg","https://i.pinimg.com/736x/8b/43/0a/8b430af942a8482b1b817a38725adc18.jpg","https://i.pinimg.com/736x/53/ea/b3/53eab3d0b5babe47d2808e8353176127.jpg","https://i.pinimg.com/1200x/b1/7f/b5/b17fb561e2092833380731bc6553fa1f.jpg","https://i.pinimg.com/736x/ff/67/8e/ff678e727c07cd355797551d5f468f89.jpg","https://i.pinimg.com/736x/2e/f4/33/2ef433ecf11c3c52d21c83e0a8a05f2c.jpg","https://i.pinimg.com/736x/ea/98/95/ea989550c5533f9682859bd79fc6be01.jpg","https://i.pinimg.com/1200x/0e/68/de/0e68de2be0c8f1ddd5fe87aa3ca304d7.jpg","https://i.pinimg.com/1200x/6c/a9/4b/6ca94b596e161af20fe4738eadf18eef.jpg","https://i.pinimg.com/1200x/ca/f2/ee/caf2ee640db02286ed2c3617178ec958.jpg"]};async function S(){if(!U||U===window.location.pathname)return;let{data:e,error:t}=await _.from("reactions").select("*").eq("topic",U).single();if(t&&t.code==="PGRST116"){let{data:u,error:k}=await _.from("reactions").insert({topic:U,upvote:0,funny:0,love:0,surprised:0,angry:0,sad:0}).select().single();if(k){console.error("Error creating reaction entry:",k);return}e=u}else if(t){console.error("Error fetching reactions:",t);return}Z=e,i()}function i(){if(!Z)return;let e=0;Object.keys(Z).forEach(u=>{if(["topic","id","created_at"].includes(u))return;let k=Z[u]||0,A=document.getElementById(`${u}-count`);A&&(A.textContent=k,e+=k)}),document.getElementById("totalResponses").textContent=e;let t=localStorage.getItem(U);document.querySelectorAll(".reaction").forEach(u=>{u.classList.toggle("reacted",u.dataset.reaction===t)})}async function l(e){if(B||!U)return;B=!0;let t=localStorage.getItem(U),u;t===e?(localStorage.removeItem(U),u=_.rpc("decrement_reaction",{topic_name:U,reaction_name:e})):t?(localStorage.setItem(U,e),u=_.rpc("switch_reaction",{topic_name:U,old_reaction_name:t,new_reaction_name:e})):(localStorage.setItem(U,e),u=_.rpc("increment_reaction",{topic_name:U,reaction_name:e}));let{error:k}=await u;k&&(console.error("Failed to update reaction:",k),t?localStorage.setItem(U,t):localStorage.removeItem(U)),await S(),B=!1}async function f(e){if(w=e?.user||null,w){R.style.display="none",s.style.display="block";let t=w.user_metadata?.username||(w.is_anonymous?"Guest User":w.email);O.textContent=t,I=w.user_metadata?.profile_url||"https://cdn-icons-png.flaticon.com/128/1046/1046929.png",j.src=I}else R.style.display="block",s.style.display="none";M()}_.auth.onAuthStateChange((e,t)=>{f(t)}),document.getElementById("signInBtn").addEventListener("click",async()=>{let e=document.getElementById("loginEmail").value,t=document.getElementById("loginPassword").value,{error:u}=await _.auth.signInWithPassword({email:e,password:t});u?alert(u.message):z.style.display="none"}),document.getElementById("signUpBtn").addEventListener("click",async()=>{let e=document.getElementById("signupEmail").value,t=document.getElementById("signupPassword").value,u=document.getElementById("signupUsername").value.trim();if(!u)return alert("Please enter a display name for signup.");let{data:k,error:A}=await _.auth.signUp({email:e,password:t,options:{data:{username:u,profile_url:"https://cdn-icons-png.flaticon.com/128/1046/1046929.png"}}});A?alert(A.message):k.user&&(alert("Signed up successfully! Please check your email to confirm your account."),z.style.display="none")}),document.getElementById("guestSignInBtn").addEventListener("click",async()=>{let{data:e,error:t}=await _.auth.signInAnonymously();t?(console.error("GUEST SIGN-IN FAILED:",t),alert(t.message)):z.style.display="none"}),y.addEventListener("click",async()=>{let{error:e}=await _.auth.signOut();e&&alert(e.message)});function p(){z.style.display=z.style.display==="block"?"none":"block",r("login")}function g(){$.style.display=$.style.display==="block"?"none":"block",document.querySelectorAll("#avatarModal .tab-content img").forEach(t=>t.classList.remove("selected"));let e=document.querySelector(`#avatarModal img[src="${I}"]`);e&&e.classList.add("selected")}function r(e){document.querySelectorAll("#authModal .tab-content").forEach(t=>t.classList.remove("active")),document.getElementById(e).classList.add("active"),document.querySelectorAll("#authModal .tab-btn").forEach(t=>t.classList.remove("active")),document.querySelector(`#authModal .tab-btn[data-tab="${e}"]`).classList.add("active")}function L(e){document.querySelectorAll("#avatarModal .tab-content").forEach(u=>u.classList.remove("active")),document.getElementById(e).classList.add("active"),document.querySelectorAll("#avatarModal .tab-btn").forEach(u=>u.classList.remove("active")),document.querySelector(`#avatarModal .tab-btn[data-tab="${e}"]`).classList.add("active")}Q.addEventListener("click",p),ee.addEventListener("click",p),H.addEventListener("click",g),j.addEventListener("click",g),document.querySelectorAll("#authModal .tab-btn").forEach(e=>e.addEventListener("click",()=>r(e.dataset.tab))),document.querySelectorAll("#avatarModal .tab-btn").forEach(e=>e.addEventListener("click",()=>L(e.dataset.tab)));function h(){Object.entries(x).forEach(([e,t])=>{let u=document.getElementById(e);u&&(u.innerHTML="",t.forEach(k=>{let A=document.createElement("img");A.src=k,A.addEventListener("click",()=>{document.querySelectorAll("#avatarModal .tab-content img").forEach(G=>G.classList.remove("selected")),A.classList.add("selected"),I=k}),u.appendChild(A)}))})}F.addEventListener("click",async()=>{if(!w)return alert("You must be logged in to save an avatar.");let{data:e,error:t}=await _.auth.updateUser({data:{profile_url:I}});t?alert("Error saving avatar: "+t.message):(e.user&&(w.user_metadata.profile_url=e.user.user_metadata.profile_url,j.src=e.user.user_metadata.profile_url),g(),alert("Avatar saved successfully!"))});async function q(){let{data:{user:e}}=await _.auth.getUser();if(!e)return p();let t=m.value.trim(),u=e.user_metadata?.username||e.email;e.is_anonymous&&(u="Guest User");let k=e.user_metadata?.profile_url||I;if(!t)return alert("Message is required.");let A={user_id:e.id,username:u,message:t,profile_url:k,created_at:new Date().toISOString(),likes:0,dislikes:0,emoji:null,topic:U},{error:G}=await _.from("comments").insert([A]);G?(console.error("DATABASE ERROR:",G),alert("Could not post comment. See console for details.")):(m.value="",M())}c.addEventListener("click",q);async function v(e,t){let{data:{user:u}}=await _.auth.getUser();if(!u)return p();let k=u.user_metadata?.username||u.email;u.is_anonymous&&(k="Guest User");let A=u.user_metadata?.profile_url||I,{error:G}=await _.from("comments").insert([{user_id:u.id,username:k,message:t,profile_url:A,created_at:new Date().toISOString(),parent_id:e,likes:0,dislikes:0,emoji:null,topic:U}]);G?(console.error("DATABASE ERROR on reply:",G),alert("Error submitting reply. See console for details.")):M()}function o(e){let t=new Date(e),k=Math.floor((new Date-t)/1e3);return k<60?`${k}s ago`:k<3600?`${Math.floor(k/60)}m ago`:k<86400?`${Math.floor(k/3600)}h ago`:`${Math.floor(k/86400)}d ago`}let n=document.getElementById("customSortDropdown"),a=n.querySelector(".selected-option"),d=n.querySelector(".dropdown-options");a.addEventListener("click",()=>{d.style.display=d.style.display==="block"?"none":"block"}),d.querySelectorAll("li").forEach(e=>{e.addEventListener("click",()=>{d.querySelectorAll("li").forEach(t=>t.classList.remove("active")),e.classList.add("active"),a.innerText=e.innerText,d.style.display="none",T=e.dataset.value==="recent",M()})}),document.addEventListener("click",e=>{n.contains(e.target)||(d.style.display="none")});async function b(e,t){let{data:{user:u}}=await _.auth.getUser();if(!u)return p();let{data:k,error:A}=await _.from("comments").select(t).eq("id",e).single();if(A){console.error(`Error fetching ${t} count:`,A);return}let G=(k[t]||0)+1,{error:N}=await _.from("comments").update({[t]:G}).eq("id",e);N?(console.error(`Error updating ${t} count:`,N),alert(`Could not update ${t}. See console for details.`)):M()}async function M(){let{data:e,error:t}=await _.from("comments").select("*").eq("topic",U).order("created_at",{ascending:!T});if(t){if(t.code==="PGRST116"){document.getElementById("comments-list").innerHTML="",document.getElementById("commentCount").innerText=0;return}return console.error("Error loading comments:",t)}let u=document.getElementById("comments-list");u.innerHTML="";let k=e.filter(N=>!N.parent_id),A=e.filter(N=>N.parent_id),G=(N,ie=!1)=>{let re=1,ne=document.createElement("div"),se=A.some(X=>X.parent_id===N.id),oe=ie?"comment reply-box":"comment";se||(oe+=" no-replies"),ne.className=oe,ne.innerHTML=`
              <div class="comment-header">
                <img src="${N.profile_url}" />
                <div><strong>${N.username}</strong> <small>${o(N.created_at)}</small></div>
              </div>
              <div class="comment-body">${N.message}</div>
              <div class="comment-footer">
                <span class="like-btn" data-id="${N.id}"><i class="bi bi-hand-thumbs-up"></i> <span class="like-count">${N.likes||0}</span></span>
                <span class="dislike-btn" data-id="${N.id}"><i class="bi bi-hand-thumbs-down"></i> <span class="dislike-count">${N.dislikes||0}</span></span>
                <span class="reply-btn" data-id="${N.id}"><i class="bi bi-chat-left-text"></i> Reply</span>
              </div>
              <div class="replies"></div>`;let J=ne.querySelector(".replies");return ne.querySelector(".like-btn").addEventListener("click",()=>b(N.id,"likes")),ne.querySelector(".dislike-btn").addEventListener("click",()=>b(N.id,"dislikes")),ne.querySelector(".reply-btn").addEventListener("click",()=>{if(J.innerHTML="",!w)return p();let X=document.createElement("div");X.innerHTML=`<textarea placeholder="What's on your mind?" class="reply-message"></textarea><button class="comment-btn reply-submit">Submit Reply</button>`,J.appendChild(X),X.querySelector(".reply-submit").addEventListener("click",async()=>{let te=X.querySelector(".reply-message").value.trim();te?await v(N.id,te):alert("Reply message required")})}),A.filter(X=>X.parent_id===N.id).forEach(X=>{let te=G(X,!0);te.classList.add(`reply-${re++}`),J.appendChild(te)}),ne};document.getElementById("commentCount").innerText=e.length,k.forEach(N=>u.appendChild(G(N))),E()}function E(){document.querySelectorAll(".comment.reply-box.last-reply").forEach(e=>{e.classList.remove("last-reply")}),document.querySelectorAll(".replies").forEach(e=>{let t=e.querySelectorAll(".comment.reply-box");t.length>0&&t[t.length-1].classList.add("last-reply")})}(async()=>{h(),await S();let{data:{session:e}}=await _.auth.getSession();await f(e),document.querySelectorAll(".reaction").forEach(t=>{t.addEventListener("click",()=>l(t.dataset.reaction))})})()});(function(){let Y="https://ebswuixgklryutksfavw.supabase.co",K="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVic3d1aXhna2xyeXV0a3NmYXZ3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ5MTEwNTgsImV4cCI6MjA3MDQ4NzA1OH0.fFie0cVqkHsZsiqOArnUECt-FaahQ4kIPB5rcYEpNlg",P="https://abefilm.github.io/MOVIEBOX-TMDB/";function W(D){if(!D)return"";let C=D.trim();return C=C.replace(/^(https?:\/\/)?/i,""),C=C.replace(/\/+$/,""),C=C.split("?")[0],C}async function _(){let D=W(window.location.hostname),C=[D];D.startsWith("www.")&&C.push(D.replace("www.",""));try{let V=`domain=in.(${C.map(m=>`"${m}"`).join(",")})`,U=`${Y}/rest/v1/licenses?${V}&select=*`,z=await fetch(U,{headers:{apikey:K,Authorization:`Bearer ${K}`}});if(!z.ok)throw new Error(`Supabase returned status: ${z.status}`);let ee=await z.json();if(!ee||ee.length===0){console.error(`License check failed: No valid license found for "${D}". Redirecting.`),window.location.href=P;return}let Q=ee[0],R=new Date,s=new Date(Q.expiry_date);if(s.setDate(s.getDate()+1),Q.status!=="forever"&&s<R){console.error(`License expired on: ${Q.expiry_date}. Redirecting.`),window.location.href=P;return}console.log(`\u2705 License valid for ${D} | Expires: ${Q.expiry_date} | Status: ${Q.status}`)}catch(V){console.error("License check process failed:",V),window.location.href=P}}_()})();})();
